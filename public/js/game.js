let difficulty1 = [
  {
    "questionNumber": 1,
    "question": "What do you get when you multiply all the numbers on your phone?",
    "imgSrc": "quiz_images/q1_1.jpg",
    "answer_choices": [
      "96",
      "323,000",
      "0",
      "362,880"
    ],
    "answer": "0"
  },
  {
    "questionNumber": 2,
    "question": "Complete the password:",
    "imgSrc": "quiz_images/q1_2.jpg",
    "answer_choices": [
      "ER",
      "YT",
      "JS",
      "FL"
    ],
    "answer": "FL"
  },
  {
    "questionNumber": 3,
    "question": "What’s the thing the British don’t have?",
    "imgSrc": "quiz_images/q1_3.jpg",
    "answer_choices": [
      "4th of July",
      "Coffee",
      "Dentists",
      "President"
    ],
    "answer": "President"
  },
  {
    "questionNumber": 4,
    "question": "Which state includes a 6-letter state?",
    "imgSrc": "quiz_images/q1_4.jpg",
    "answer_choices": [
      "California",
      "Iowa",
      "Arkansas",
      "Texas"
    ],
    "answer": "Arkansas"
  },
  {
    "questionNumber": 5,
    "question": "Which world city has the largest population of Spanish speakers?",
    "imgSrc": "quiz_images/q1_5.jpg",
    "answer_choices": [
      "United States",
      "Argentina",
      "Spain",
      "Rome"
    ],
    "answer": "Rome"
  }
]
let difficulty2 = [
  {
    "questionNumber": 6,
    "question": "What do the first two numbers on this receipt add up to?",
    "imgSrc": "quiz_images/q2_1.jpg",
    "answer_choices": [
      "14",
      "189",
      "707",
      "799"
    ],
    "answer": "14"
  },
  {
    "questionNumber": 7,
    "question": "You are in the lobby of the Empire State Building, How many flights of stairs will it take to get to the 34th floor?",
    "imgSrc": "quiz_images/q2_2.jpg",
    "answer_choices": [
      "31",
      "32",
      "33",
      "34"
    ],
    "answer": "33"
  },
  {
    "questionNumber": 8,
    "question": "How many numbers between 1 and 100 have the letter ‘A’ in their spelling?",
    "imgSrc": "quiz_images/q2_3.jpg",
    "answer_choices": [
      "10",
      "0",
      "23",
      "100"
    ],
    "answer": "0"
  },
  {
    "questionNumber": 9,
    "question": "If you jump in the air, what is the longest you can stay afloat?",
    "imgSrc": "quiz_images/q2_4.jpg",
    "answer_choices": [
      "0.0 s",
      "0.5 s",
      "1.0 s",
      "60.0 s"
    ],
    "answer": "0.0 s"
  },
  {
    "questionNumber": 10,
    "question": "How many total pupils do you see?",
    "imgSrc": "quiz_images/q2_5.jpg",
    "answer_choices": [
      "0",
      "12",
      "18",
      "24"
    ],
    "answer": "18"
  }
]
let difficulty3 = [
  {
    "questionNumber": 11,
    "question": "Which cheese is made backwards?",
    "imgSrc": "quiz_images/q3_1.jpg",
    "answer_choices": [
      "CHEDDAR",
      "SWISS",
      "BRIE",
      "EDAM"
    ],
    "answer": "EDAM"
  },
  {
    "questionNumber": 12,
    "question": "Which letter comes next in this sequence? WLCNIT_",
    "imgSrc": "quiz_images/q3_2.jpg",
    "answer_choices": [
      "M",
      "S",
      "A",
      "P"
    ],
    "answer": "S"
  },
  {
    "questionNumber": 13,
    "question": "Click the number of characters below that were created by Walt Disney:",
    "imgSrc": "quiz_images/q3_3.jpg",
    "answer_choices": [
      "4",
      "2",
      "0",
      "3"
    ],
    "answer": "0"
  },
  {
    "questionNumber": 14,
    "question": "Logically, which pageant participant does not belong?",
    "imgSrc": "quiz_images/q3_4.jpg",
    "answer_choices": [
      "HAPEN",
      "ION",
      "TEAK",
      "ISSIPPI"
    ],
    "answer": "TEAK"
  },
  {
    "questionNumber": 15,
    "question": "If it’s 5:05 in New York, How many hands are in this picture?",
    "imgSrc": "quiz_images/q3_5.jpg",
    "answer_choices": [
      "14",
      "2",
      "10",
      "13"
    ],
    "answer": "13"
  }
]
let difficulty4 = [
  {
    "questionNumber": 16,
    "question": "What letter appears exactly 4 times on the menu?",
    "imgSrc": "quiz_images/q4_1.jpg",
    "answer_choices": [
      "R",
      "S",
      "V",
      "P"
    ],
    "answer": "R"
  },
  {
    "questionNumber": 17,
    "question": "What’s the name of the street with the graffitied sign?",
    "imgSrc": "quiz_images/q4_2.jpg",
    "answer_choices": [
      "Chump",
      "Chalet",
      "Chesterfield",
      "College"
    ],
    "answer": "Chalet"
  },
  {
    "questionNumber": 18,
    "question": "Which of these is mixed ‘with care’?",
    "imgSrc": "quiz_images/q4_3.jpg",
    "answer_choices": [
      "Desert Snowman",
      "Gurple",
      "Arc White",
      "MC Hammer Pant"
    ],
    "answer": "Arc White"
  },
  {
    "questionNumber": 19,
    "question": "Which way is this U.S. bus going?",
    "imgSrc": "quiz_images/q4_4.jpg",
    "answer_choices": [
      "Why are you asking difficult questions?",
      "Left",
      "Right",
      "I’m an idiot!"
    ],
    "answer": "Left"
  },
  {
    "questionNumber": 20,
    "question": "What did Peter Pan’s nose do when he lied?",
    "imgSrc": "quiz_images/q4_5.jpg",
    "answer_choices": [
      "GROW",
      "SHRINK",
      "NOTHING",
      "TWINKLE"
    ],
    "answer": "NOTHING"
  }
]
let difficulty5 = [
  {
    "questionNumber": 21,
    "question": "What number is the car over?",
    "imgSrc": "quiz_images/q5_1.jpg",
    "answer_choices": [
      "78",
      "88A",
      "87",
      "88B"
    ],
    "answer": "87"
  },
  {
    "questionNumber": 22,
    "question": "ECNETNES SDRAWKCAB: .PART TAR PAT, WAS TON, BONK TON",
    "imgSrc": "quiz_images/q5_2.jpg",
    "answer_choices": [
      "rat trap",
      "door knob",
      "saw",
      "dog"
    ],
    "answer": "rat trap"
  },
  {
    "questionNumber": 23,
    "question": "Logically, which letter should go on the green crayon?",
    "imgSrc": "quiz_images/q5_3.jpg",
    "answer_choices": [
      "E",
      "G",
      "N",
      "D"
    ],
    "answer": "N"
  },
  {
    "questionNumber": 24,
    "question": "How many times does you mouth close when singing the following sentence: ‘Hey Papa, please pass the peas to mama.’",
    "imgSrc": "quiz_images/q5_4.jpg",
    "answer_choices": [
      "6",
      "0",
      "2",
      "7"
    ],
    "answer": "7"
  },
  {
    "questionNumber": 25,
    "question": "Which player has the most RBIs?",
    "imgSrc": "quiz_images/q5_5.jpg",
    "answer_choices": [
      "Temple Gladstone",
      "Norbit Orbison",
      "Greg Death",
      "Karl Von Fancy"
    ],
    "answer": "Norbit Orbison"
  }
]
let difficulty6 = [
  {
    "questionNumber": 26,
    "question": "Who doesn’t feel at home here?",
    "imgSrc": "quiz_images/q6_1.jpg",
    "answer_choices": [
      "Beer",
      "Snail",
      "Kangaroo",
      "Rabbit"
    ],
    "answer": "Snail"
  },
  {
    "questionNumber": 27,
    "question": "How much wood did that woodchuck, Chuck, chuck when that woodchuck chucked his wood?",
    "imgSrc": "quiz_images/q6_2.jpg",
    "answer_choices": [
      "I have no idea",
      "40",
      "20",
      "6"
    ],
    "answer": "6"
  },
  {
    "questionNumber": 28,
    "question": "Touch the animal that should go on the empty box.",
    "imgSrc": "quiz_images/q6_3.jpg",
    "answer_choices": [
      "Goat",
      "Pig",
      "Rabbit",
      "Bat"
    ],
    "answer": "Bat"
  },
  {
    "questionNumber": 29,
    "question": "On what day of the week does the gym offer the fewest classes?",
    "imgSrc": "quiz_images/q6_4.jpg",
    "answer_choices": [
      "Friday",
      "Sunday",
      "Saturday",
      "Monday"
    ],
    "answer": "Sunday"
  },
  {
    "questionNumber": 30,
    "question": "What would be in Michael’s gift box?",
    "imgSrc": "quiz_images/q6_5.jpg",
    "answer_choices": [
      "Keyboard Toy",
      "Jokes Book",
      "Ice cream",
      "Mic"
    ],
    "answer": "Mic"
  }
]

const questionContainerElement = document.getElementById('question-container');
const questionElement = document.getElementById('question');
const answerButtonsElement = document.getElementById('answer-buttons');
const nextButton = document.getElementById('next-btn');
const imageElement = document.getElementById('img');
const moneyElement = document.getElementById('money');
let remainingTime = document.querySelector(".remaining-time");
const seeGameStats = document.getElementById('see-game-stats');
let difficulties = [difficulty1, difficulty2, difficulty3, difficulty4, difficulty5, difficulty6];

let difficulty = 1;
let money;
let currentQuestion = null;
let answerClicked = false;
let questionsAnswered = [];
let interval;
let lastdifficultyTimer;
let total = 0;
let correct = 0;
let wrong = 0;
let total6 = 0;
let game;
let highscore;

nextButton.addEventListener('click', () => {
  setNextQuestion();
})

seeGameStats.addEventListener('click', () => {
  $.ajax({
    url: "/scores/gamestats",
    type: "GET",
    dataType: 'html',
    headers: {
      Authorization: window.localStorage.getItem("token")
    },
    complete: (data) => {
        console.log("status for GET: " + data.status)

        document.open('text/html')
        document.write(data.responseText);
        document.close();
    }
  });
  //location.replace("/scores/gamestats");
})

function startGame() {
  let questions = difficulties[difficulty-1];
  currentQuestion = questions[Math.floor(Math.random()*questions.length)];
  showQuestion(currentQuestion);
}

function setNextQuestion() {
  difficulty++;
  startGame();
  hideNextQuestionButton();
  hideGameStats();
  startTimer();
  if(difficulty == 6) {
    difficulty6Timer();
    hideNextQuestionButton();
    hideGameStats();
  }
}

function gameOver() {
  nextButton.classList.remove("show");
  seeGameStats.classList.add("show");
}

function showQuestion(question) {
  questionElement.innerText = question.question;
  imageElement.src = question.imgSrc;
  while (answerButtonsElement.hasChildNodes()) {
    answerButtonsElement.removeChild(answerButtonsElement.lastChild);
  }
  answerButtonsElement.innerHTML = "";
  for(let i = 0; i < question.answer_choices.length; i++) {
    let answer = document.createElement('button');
    answer.innerHTML = question.answer_choices[i];
    answer.classList.add('btn');
    answer.setAttribute("onclick", "check(this)");
    answerButtonsElement.appendChild(answer);
  }
}

function showNextQuestionButton() {
  nextButton.classList.add("show");
}

function hideNextQuestionButton() {
  nextButton.classList.remove("show");
}

function showGameStats () {
  seeGameStats.classList.add("show");
}

function hideGameStats () {
  seeGameStats.classList.remove("show");
}

function check(ele) {
  if (difficulty == 6) {
    difficulty6check(ele);
    return;
  }
  let userSelect = ele.innerHTML;
  if(userSelect === currentQuestion.answer) {
    ele.classList.add("correct");
    saveState(true);
  } else {
    ele.classList.add("wrong");
    for(let j = 0; j < answerButtonsElement.children.length; j++) {
      if(answerButtonsElement.children[j].innerHTML === currentQuestion.answer) {
        answerButtonsElement.children[j].classList.add("show-correct");
      }
    }
    moneyElement.innerText = '$' + 0;
    money = 0;
    saveState(false);
  }
  disableAnswer();
  showNextQuestionButton();
  hideGameStats();
  stopTimer();

  if(difficulty == difficulties.length) {
    gameOver();
  }
}

function compute() {
  for (let i = 0; i < questionsAnswered.length; i++) {
    if(questionsAnswered[i].isRight == true) {
      correct++;
    } else if(questionsAnswered[i].isRight == false) {
      wrong++;
    }
    if(questionsAnswered[i].difficulty == 5) {
      for (let j = 0; j < questionsAnswered.length-1; j++) {
        total += questionsAnswered[j].money;
      }
    }
    if(questionsAnswered[i].difficulty == 6 && questionsAnswered[i].isRight == true) {
      total6 = total + 500;
    } else if (questionsAnswered[i].difficulty == 6 && questionsAnswered[i].isRight == false)  {
      total6 = total;
    }
  }

  if (localStorage.getItem("game") === null) {
    localStorage.setItem("game", "0");
  }

  game =  parseInt(localStorage.getItem("game"));
  window.localStorage.setItem("game", `${++game}`);

  if (localStorage.getItem("highscore") === null) {
    localStorage.setItem("highscore", "0");
  }

  highscore = parseInt(localStorage.getItem("highscore"));
  if(total6 > highscore) {
    highscore = total6;
    window.localStorage.setItem("highscore", highscore);
  }
}

function callAtEndOfDifficulty() {
  let payload = {
    questionResults: questionsAnswered,
    score: total6,
    correct: correct,
    incorrect: wrong,
    numberofGames: window.localStorage.getItem("game"),
    highscore: parseInt(window.localStorage.getItem("highscore"))
  };

  $.ajax({
    url: "/scores/gamestats",
    type: "POST",
    headers: {
      Authorization: window.localStorage.getItem("token")
    },
    data: payload,
    complete: (data) => {
        console.log("status for POST: " + data.status)
    }
  });

}

function difficulty6check(ele) {
  let userSelect = ele.innerHTML;
  if(userSelect === currentQuestion.answer) {
    ele.classList.add("correct");
    saveState(true);
  }
  else {
    ele.classList.add("wrong");
    for(let j = 0; j < answerButtonsElement.children.length; j++) {
      if(answerButtonsElement.children[j].innerHTML === currentQuestion.answer) {
        answerButtonsElement.children[j].classList.add("show-correct");
      }
    }
    saveState(false);
  }
  disableAnswer();
  stopTimer();
  compute();
  callAtEndOfDifficulty();
  showGameStats();

}

function disableAnswer() {
  for(let i = 0; i < answerButtonsElement.children.length; i++) {
    answerButtonsElement.children[i].classList.add("already-answered");
  }
}

function saveState(isRight) {
  questionsAnswered.push({
    difficulty: difficulty,
    money: money,
    isRight: isRight,
  })
}

function timeisUp() {
  for(let j = 0; j < answerButtonsElement.children.length; j++) {
    if(answerButtonsElement.children[j].innerHTML === currentQuestion.answer) {
      answerButtonsElement.children[j].classList.add("show-correct");
    }
  }
  disableAnswer();
  showNextQuestionButton();
  hideGameStats();
  saveState(false);
  if(difficulty == 6) {
    hideNextQuestionButton();
    compute();
    callAtEndOfDifficulty();
    showGameStats();
  }
}

function startTimer() {
  if (difficulty != 6) {
      money = (200*difficulty) + 100;
  }
  remainingTime.innerHTML = money;
  moneyElement.innerText = '$' + money;
  interval = setInterval(() => {
    if(!answerClicked && difficulty != 6) {
      money = Math.max(0, money-difficulty * 20);
      if (money == 0) {
        clearInterval(interval);
        timeisUp();
      }
      moneyElement.innerText = '$' + money;
    }
  }, 1000);
}

function difficulty6Timer() {
  lastdifficultyTimer = 10;
  remainingTime.innerHTML = lastdifficultyTimer;
  interval = setInterval(() => {
    lastdifficultyTimer --;
    remainingTime.innerHTML = lastdifficultyTimer;
    if(lastdifficultyTimer == 0) {
      clearInterval(interval);
      timeisUp();
    }
  }, 1000);
}

function stopTimer() {
  clearInterval(interval);
}

window.onload=()=> {
  startTimer();
  startGame();
}
